- name: Clone or Pull Repository from AWX Project
  hosts: all
  tasks:
    - name: Install Git (if not installed)
      package:
        name: git
        state: present

    - name: Ensure the destination directory exists
      file:
        path: "/home/jatin/awx-POC/demo-pull"
        state: directory
        owner: "jatin"
        group: "jatin"
        mode: '0755'

    - name: Clone the repository if not already cloned
      git:
        repo: "git@github.com:jatinsuthartalentica/ansible-tower-poc.git"
        dest: "/home/jatin/awx-POC/demo-pull"
        clone: yes
        update: no
      register: git_clone

    - name: Pull the latest changes if already cloned
      git:
        repo: "git@github.com:jatinsuthartalentica/ansible-tower-poc.git"
        dest: "/home/jatin/awx-POC/demo-pull"
        update: yes
      when: git_clone is not changed
